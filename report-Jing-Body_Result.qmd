---
title: "Body_Result"
author: "Jingyi Wang"
format: html
editor: visual
---
## Load Library
```{r}
library(tidyverse)
```

The data:
```{r}
water_quality <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/main/data/2025/2025-05-20/water_quality.csv')
weather <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/main/data/2025/2025-05-20/weather.csv')

```

```{r}
start_date <- as.Date("2015-04-28", tz ="Australia/Sydney")
end_date <- as.Date("2025-04-28", tz ="Australia/Sydney")

water_quality <- water_quality %>%
  filter(date >= start_date & date <= end_date)

weather <- weather %>%
  filter(date >= start_date & date <= end_date)

```

Figure:
```{r}
top_beaches <- water_quality %>%
  group_by(swim_site) %>%
  summarise(avg_enterococci = mean(enterococci_cfu_100ml, na.rm = TRUE)) %>%
  arrange(desc(avg_enterococci)) %>%
  slice(1:10)
```

```{r}
#| label: fig-bar_chart
#| fig-cap: "Top 10 Beaches with Worst Water Quality"
#| echo: false

ggplot(top_beaches, aes(x = reorder(swim_site, avg_enterococci), 
                        y = avg_enterococci,
                        fill = reorder(swim_site,
                                       avg_enterococci))) +  
  
  geom_col() +  
  
  scale_fill_viridis(discrete = TRUE, 
                     option = "D", 
                     direction = -1) +  
  
  coord_flip() +
  
  labs(title = "Top 10 Beaches with Worst Water Quality",
       subtitle = "Based on average enterococci levels",
       x = "Beach",
       y = "Average Enterococci (CFU/100ml)",
       caption = "Data source: TidyTuesday") +
  
  theme_minimal(base_size = 10) +
  
  theme(
    plot.title = element_text(face = "bold", size = 13),
    plot.subtitle = element_text(color = "gray40"),
    axis.title = element_text(face = "bold"),
    axis.text = element_text(color = "black"),
    legend.position = "none",  # Remove legend
    panel.grid.major.y = element_blank(),  # Remove horizontal grid lines
    plot.caption = element_text(color = "gray50", hjust = 0)
  )

```



Table:
```{r}
# In weather dataset, both latitude and longitude have only unique values.
weather <- weather %>%
  select(-latitude, -longitude)

# Merge water and weather datasets by date
water_weather <- water_quality %>%
  left_join(weather, by = "date")
```

```{r}
water_weather <- water_weather %>%
  mutate(rain_group = case_when(
    precipitation_mm == 0 ~ "0 mm",
    precipitation_mm <= 10 ~ "0–10 mm",
    TRUE ~ ">10 mm"
  ))

```

```{r}
#| label: tbl-rain_table
#| tbl-cap: Average Enterococci by Rain Group

rain_table <- water_weather %>%
  group_by(rain_group) %>%
  summarise(mean_enterococci = mean(enterococci_cfu_100ml, na.rm = TRUE))
kable(rain_table)
```

Figure2:

```{r}
#| label: fig-boxplot
#| fig-cap: "Boxplot of Enterococci Levels by Rainfall Group"

ggplot(water_weather, 
       aes(x = rain_group, 
           y = enterococci_cfu_100ml, 
           fill = rain_group)) +  
  geom_boxplot(
    width = 0.6,                
    color = "black",            
    size = 0.5,                 
    outlier.alpha = 0.5         # Outlier transparency
  ) +
  scale_y_log10() +
  scale_fill_manual(
    values = c("0 mm" = "#FDE725",    # viridis 浅色（无雨）
               "0–10 mm" = "#7AD151", # viridis 中等（小雨）
               ">10 mm" = "#31688E"), # viridis 深色（大雨）
    breaks = c("0 mm", "0–10 mm", ">10 mm")  # 确保顺序一致
  ) +
  labs(
    title = "Enterococci Levels by Rainfall Group",
    subtitle = "Log-transformed bacteria concentration (CFU/100ml)",
    x = "Rainfall Group",
    y = "Enterococci (CFU/100ml, log10)",
    caption = "Color intensity reflects rainfall amount"
  ) +
  theme_minimal(base_size = 10) +
  theme(
    plot.title = element_text(face = "bold", size = 13),
    plot.subtitle = element_text(color = "gray40"),
    axis.title = element_text(face = "bold"),
    legend.position = "none",     # Remove legend
    panel.grid.major.x = element_blank(), # Remove vertical grid lines
    panel.grid.minor = element_blank()
  )
```

## Result

From @fig-bar_chart, the beach with the highest average pollution level is Wentworth Falls Lake - Jetty, with more than 500 CFU/100ml. This is about twice the level of the second-ranked site, Megalong Creek. The other eight beaches in the top 10 also show high pollution, at average values above 100 CFU/100ml. These results suggest that certain beaches consistently have poor water quality from 2015 to 2025.

The @tbl-rain_table shows that beaches with rainfall greater than 10mm had significantly higher enterococci levels compared to those with 0mm rainfall. It suggests a strong relationship between heavy rainfall and increased bacteria concentration. The boxplot in @fig-boxplot further supports this pattern. The log-transformed enterococci levels are clearly higher in the >10mm group. Besides, the entire box of >10mm group is shifted upward, showing that rainfall likely plays a major role in pollution spikes.

These findings are consistent with prior research that links high bacteria levels with increased illness risk in swimmers, including diarrhea and ear infections (Wade et al., 2012). Similar results were found by Soller et al. (2010), who showed that bacterial concentrations tend to rise after heavy rainfall, increasing the likelihood of gastrointestinal illness.


## Reference

Ackerman, D., & Weisberg, S. B. (2003). Relationship between rainfall and beach bacterial concentrations on Santa Monica Bay beaches. Journal of water and health, 1(2), 85-89.

Colford, J. M., Jr, Schiff, K. C., Griffith, J. F., Yau, V., Arnold, B. F., Wright, C. C., Gruber, J. S., Wade, T. J., Burns, S., Hayes, J., McGee, C., Gold, M., Cao, Y., Noble, R. T., Haugland, R., & Weisberg, S. B. (2012). Using rapid indicators for Enterococcus to assess the risk of illness after exposure to urban runoff contaminated marine water. Water research, 46(7), 2176–2186. https://doi.org/10.1016/j.watres.2012.01.033

